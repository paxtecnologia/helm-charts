{{- if .Values.networkPolicy.egress.enabled }}
  {{- $policies := .Values.networkPolicy.egress }}
  {{- range $name, $config := $policies }}
    {{- if ne $name "enabled" }}
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-egress-{{ $name }}
  namespace: {{ .Release.Namespace }}
spec:
  podSelector: {{- toYaml (default dict $config.podSelector) | nindent 4 }}
  policyTypes:
    - Egress
  {{- if $config.namespaceSelectorLabel }}
  egress:
    - from:
        {{- if $config.namespaceSelectorLabel }}
        - namespaceSelector:
            matchLabels:
              {{- toYaml $config.namespaceSelectorLabel | nindent 14 }}
        {{- end }}
  {{- end }}
    {{- end }}
  {{- end }}
{{- end }}
